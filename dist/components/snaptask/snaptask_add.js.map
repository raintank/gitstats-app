{"version":3,"sources":["../../../src/components/snaptask/snaptask_add.js"],"names":[],"mappings":"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","file":"snaptask_add.js","sourcesContent":["import _ from 'lodash';\n\nclass SnapTaskAddCtrl {\n  constructor($scope, $injector, $q, $location, backendSrv, alertSrv) {\n    this.$q = $q;\n    this.$location = $location;\n    this.backendSrv = backendSrv;\n    this.alertSrv = alertSrv;\n    this.$scope = $scope;\n    this.pageReady = true;\n    this.creatingTasks = false;\n    this.error = null;\n    this.taskType = \"\";\n    this.access_token = \"\"\n    this.newTask = {};\n    this.queuedTask = [];\n    this.ns1Token = null;\n}\n\n  cancel() {\n    this.queuedTask = [];\n    this.newTak = {};\n  }\n\n  queueTask() {\n    this.queuedTask.push({\n      user: this.newTask.user,\n      repo: this.newTask.repo,\n    });\n    this.newTask = {};\n  }\n\n  create() {\n    var self = this;\n    this.creatingTasks = true;\n    var promises = [];\n    _.forEach(this.queuedTask, function(task) {\n      promises.push(self.addTask(task));\n    });\n\n    this.$q.all(promises).then(()=>{\n      console.log(\"finished creating tasks.\");\n      self.queuedTask = [];\n      self.creatingTasks = false;\n      self.$location.path(\"plugins/raintank-gitstats-app/page/list-tasks\");\n    }, (resp)=>{\n      console.log(\"failed to add all tasks.\", resp);\n      self.creatingTasks = false;\n      self.alertSrv.set(\"failed to create task\", resp, 'error', 10000);\n    });\n  }\n\n  taskLabel(task) {\n    var user = task.user;\n    if (!user) {\n      user = \"*\";\n    }\n    var repo = task.repo;\n    if (!repo) {\n      repo = \"*\";\n    }\n    return \"Github Stats: \"+user+\"/\"+repo\n  }\n\n  addTask(t) {\n    if (this.access_token === \"\") {\n      return this.$q.reject(\"access_token not set.\")\n    }\n    var task = {\n      \"name\": \"gitstats-\"+t.user+\"/\"+t.repo,\n      \"metrics\": {\"/raintank/apps/gitstats/*\":0},\n      \"config\": {\n        \"/raintank/apps/gitstats\": {\n          \"access_token\": this.access_token,\n          \"user\": t.user,\n          \"repo\": t.repo\n        }\n      },\n      \"interval\": 600,\n      \"route\": { \"type\": \"any\"},\n      \"enabled\": true\n    };\n\n    return this.backendSrv.post(\"api/plugin-proxy/raintank-gitstats-app/tasks\", task).then((resp) => {\n      if (resp.meta.code !== 200) {\n        console.log(\"request failed.\", resp.meta.message);\n        return this.$q.reject(resp.meta.message);\n      }\n    });\n  }\n}\n\nSnapTaskAddCtrl.templateUrl = 'public/plugins/raintank-gitstats-app/components/snaptask/partials/snaptask_add.html';\nexport {SnapTaskAddCtrl};\n"]}