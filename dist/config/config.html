<p ng-if="!ctrl.appModel.jsonData.apiKeySet">Gitstats requires a Grafana.net account. <a class="highlight-word" href="//grafana.net/profile/api-keys" target="_blank">Generate a new API key</a> or <a class="highlight-word" href="//grafana.net/signup" target="_blank">sign up for free.</a></p>

<form name="editForm">
	<div class="gf-form-inline">
		<div class="gf-form wp-inline-field-margin--right">
			<a class="gf-form-label width-12" href="//grafana.net/profile/api-keys" target="_blank"><img src="public/plugins/raintank-worldping-app/img/icon_grafana-net.svg" class="gnet-logo--inline">Grafana.net API Key</a>
			<input type="password" class="gf-form-input input-xlarge" ng-model="ctrl.appModel.secureJsonData.apiKey" ng-if="!ctrl.appModel.jsonData.apiKeySet" required>
			<input type="text" class="gf-form-input max-width-12" disabled="disabled" value="complete" ng-if="ctrl.appModel.jsonData.apiKeySet">
		</div>
		<div class="gf-form">
			<a class="btn btn-danger btn-small" href="#" ng-click="ctrl.appModel.jsonData.apiKeySet=false" ng-if="ctrl.appModel.jsonData.apiKeySet">reset</a>
		</div>
	</div>
</form>
<br>
<div ng-if="!ctrl.validKey && ctrl.errorMsg">
	<div class="alert alert-error"><div class="alert-title ng-binding">Error</div><div>{{ctrl.errorMsg}}</div></div>
</div>

<div ng-show="ctrl.appModel.enabled">
	<h5 class="section-heading">Tasks</h5><div class="text-right"><a ng-click="ctrl.toggleAddNew()">add new</a></div>

	<div class="gf-form-group" ng-if="ctrl.addNew">
		<div class="gf-form">
			<label class="gf-form-label width-7">Access Token</label>
			<input type="text" class="gf-form-input max-width-25 ng-pristine ng-untouched ng-valid ng-not-empty" ng-model="ctrl.newTask.access_token">
		</div>
		<div class="gf-form">
			<label class="gf-form-label width-7">Owner</label>
			<input type="text" class="gf-form-input max-width-25 ng-pristine ng-untouched ng-valid ng-not-empty" ng-model="ctrl.newTask.owner">
		</div>
		<div class="gf-form">
			<label class="gf-form-label width-7">Repo</label>
			<input type="text" class="gf-form-input max-width-25 ng-pristine ng-untouched ng-valid ng-not-empty" ng-model="ctrl.newTask.repo">
		</div>

		<button type="submit" class="btn btn-success" ng-click="ctrl.addNewTask()">Add</button>
		<a class="btn btn-link" ng-click="ctrl.cancelNewTask()">Cancel</a>
	</div>


	<div class="tight-form-container">
		<table class="filter-table">
			<thead>
				<tr>
					<th><strong>Access Token</strong></th>
					<th><strong>Owner</strong></th>
					<th><strong>Repo</strong></th>
					<th><strong>Interval</strong></th>
					<th style="width: 80px;"></th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="task in ctrl.tasks">
					<td>
						{{task.config["/raintank/apps/gitstats"].access_token}}
					</td>
					<td>
						{{task.config["/raintank/apps/gitstats"].owner}}
					</td>
					<td>
						{{task.config["/raintank/apps/gitstats"].repo}}
					</td>
					<td>
						{{task.interval}}
					</td>
					<td class="text-right">
						<a ng-click="ctrl.removeTask(task)" class="btn btn-danger btn-small">
							<i class="fa fa-remove"></i>
						</a>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
</div>

